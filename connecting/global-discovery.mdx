---
title: "Global discovery"
---

Placeholder: How to use relays for global discovery and best practices.

By Default, iroh uses the DNS discovery system to resolve EndpointIds to
addresses. 

## DNS Discovery

DNS performs endpoint lookups via the standard DNS systems. 

```rust
use iroh::Endpoint;

#[tokio::main]
async fn main() -> anyhow::Result<()> {
    let endpoint = Endpoint::bind().await?;

    println!("endpoint id: {:?}", endpoint.id());
    Ok(())
}
```

Now when this endpoint is instantiated, it will list itself on the DNS service.
From here we can pass along the endpoint identifier, and other endpoints will
use the DNS service to find the home relay of this endpoint.

Important notes about DNS discovery:
1. DNS discovery is the default discovery mechanism in iroh, so you don't need
   to do anything special to enable it.
2. DNS discovery only publishes the home relay of an endpoint, not its direct
   addresses. 
3. DNS discovery is opt-out, so if you don't want your endpoint to be
   discoverable via DNS, you can disable it by using the
   `Endpoint::empty_builder` method instead of `Endpoint::builder`.
4. Two nodes must connect to the same DNS discovery server to find each other using DNS discovery.


## Dedicated DNS Server

By default, runs a public shared instance of the DNS discovery server. If you'd like to
run your own private DNS discovery server for more guaranteed privacy and uptime
guarantees, you can configure iroh to use it.



## DHT Discovery

DHT discovery uses the [BitTorrent Mainline](https://en.wikipedia.org/wiki/Mainline_DHT) distributed hash table (DHT) to publish & resolve EndpointIds.

DHT Discovery is _not_ enabled by default, and must be enabled by the user. You'll need to add the `discovery-pkarr-dht` feature flag to your `Cargo.toml` to use it.

```toml
[dependencies]
# Make sure to use the most recent version here instead of nn. (at the time of writing: 0.32)
iroh = { version = "0.nn", features = ["discovery-pkarr-dht"] }
```

Then configure your endpoint to use DHT discovery concurrently with mDNS discovery, but not with the default DNS discovery, use the `Endpoint::empty_builder` method. This requires specifying a `RelayMode`, which in this example we will keep default.

```rust
use iroh::Endpoint;

let dht_discovery = iroh::discovery::dht::DhtDiscovery::builder();
let mdns = iroh::discovery::mdns::MdnsDiscovery::builder();
let ep = Endpoint::empty_builder(iroh::RelayMode::Default)
    .discovery(dnt_discovery)
    .bind()
    .await?;
```
